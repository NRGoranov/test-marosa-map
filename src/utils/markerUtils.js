import { checkIfOpen } from './timeUtils.js';

const OPEN_COLOR = '#1B4712';
const CLOSED_COLOR = '#D93025';
const CLOSING_SOON_COLOR = '#FBBC04';

export const createSelectedMarkerIcon = (color) => {
    const selectedSvg = `<svg width="72" height="84" viewBox="0 0 72 84" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0 24C0 10.7452 10.7452 0 24 0H48C61.2548 0 72 10.7452 72 24V53.459C72 63.6989 63.6989 72 53.459 72C46.4362 72 40.0161 75.9678 36.8754 82.2492L36 84L35.1246 82.2492C31.9839 75.9678 25.5638 72 18.541 72C8.3011 72 0 63.6989 0 53.459V24Z" fill="${color}" stroke="#000000" stroke-opacity="0.1" stroke-width="1"/><circle cx="36" cy="36" r="21" fill="white"/><mask id="mask0_40_200" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="15" y="15" width="42" height="42"><circle cx="36" cy="36" r="21" fill="#F4FFF2"/></mask><g mask="url(#mask0_40_200)"><path d="M-26.1768 37.5784C-27.293 38.6669 -25.764 39.1707 -24.8309 39.4604C-18.7493 41.3506 -8.62166 40.7109 -2.16714 40.5915C5.05256 40.457 12.2186 40.1934 19.4438 39.9093C24.1863 39.7226 28.999 39.2215 33.7566 39.6375C37.5949 39.9738 40.6391 41.2147 43.8058 43.3411C44.0288 43.2038 43.7604 43.0377 43.6682 42.9293C42.2245 41.2161 39.7996 40.2167 37.6802 39.6347C37.7821 39.3464 38.3174 39.2723 38.5899 39.2394C41.619 38.8838 44.6784 39.6443 46.4372 42.2264C46.751 42.6877 48.7176 46.2897 48.5511 46.4997C46.4042 45.488 43.8994 45.8051 41.641 45.0885C39.4611 44.3953 38.1358 42.6808 35.9242 42.28C33.6781 41.8723 31.2147 41.9244 28.9343 41.8393C14.521 41.2998 -0.00508308 42.3966 -14.4101 41.5579C-17.1818 41.3959 -24.0093 40.9059 -26.225 39.4782C-27.1058 38.9099 -27.4182 37.8474 -26.1782 37.5797L-26.1768 37.5784Z" fill="#1B4712"/><path d="M36.1677 37.5772C37.0829 35.0734 37.6086 32.4185 37.6788 29.7527L37.3678 30.1961L35.4094 36.8881C32.222 32.5421 35.3832 28.4472 38.7123 25.5C39.8918 27.0594 40.6033 29.0663 40.4299 31.0554C40.2055 33.6252 37.9623 35.908 36.1677 37.5786V37.5772Z" fill="#1B4712"/><path d="M48.4134 30.1648C48.017 31.8038 47.7005 33.4991 46.8334 34.9707C45.1889 37.7642 42.0552 38.9228 38.9187 38.8816C41.4937 37.6489 43.4163 35.4841 45.1104 33.2521C45.1297 33.1477 44.9797 33.1656 44.9026 33.182C44.6218 33.2397 42.3979 34.8732 41.9575 35.1862C40.6569 36.1128 39.5036 37.2755 37.9554 37.8507C37.8191 37.7134 39.6743 34.8293 39.9069 34.5136C42.0965 31.543 44.893 30.788 48.4134 30.1648Z" fill="#1B4712"/><path d="M26.808 26.7327C28.8779 27.4616 31.856 28.5186 32.9377 30.5708C33.6699 31.9586 33.9066 34.0163 33.4827 35.5181C32.3184 33.8008 31.3757 31.8722 29.6981 30.5777C30.4165 32.5366 31.5932 34.3993 31.9744 36.4735C31.9964 36.5957 32.1382 36.8373 31.9689 36.8908C30.4385 35.4865 28.2641 34.7 27.3558 32.7068C27.1782 32.3183 26.8066 31.1528 26.8066 30.7836V26.734L26.808 26.7327Z" fill="#1B4712"/></g></svg>`;
    return `data:image/svg+xml;utf8,${encodeURIComponent(selectedSvg)}`;
};

export const createUnselectedMarkerIcon = () => {
    const unselectedSvg = `<svg width="88" height="98" viewBox="0 0 88 98" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M32 9.5H56C68.8406 9.5 79.25 19.9094 79.25 32.75V62C79.25 71.9411 71.1911 80 61.25 80C54.0485 80 47.4329 83.969 44.0439 90.3232L44 90.4053L43.9561 90.3232C40.5671 83.969 33.9515 80 26.75 80C16.8089 80 8.75 71.9411 8.75 62V32.75C8.75 19.9094 19.1594 9.5 32 9.5Z" fill="white" stroke="#C7C7C7" stroke-width="1.5"/><circle cx="44" cy="44.75" r="21" fill="#C9F0C2"/><mask id="mask0_40_202" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="23" y="23" width="42" height="43"><circle cx="44" cy="44.75" r="21" fill="#FF607B"/></mask><g mask="url(#mask0_40_202)"><path d="M-18.1768 46.3284C-19.293 47.4169 -17.764 47.9207 -16.8309 48.2104C-10.7493 50.1006 -0.621658 49.4609 5.83286 49.3415C13.0526 49.207 20.2186 48.9434 27.4438 48.6593C32.1863 48.4726 36.999 47.9715 41.7566 48.3875C45.5949 48.7238 48.6391 49.9647 51.8058 52.0911C52.0288 51.9538 51.7604 51.7877 51.6682 51.6793C50.2245 49.9661 47.7996 48.9667 45.6802 48.3847C45.7821 48.0964 46.3174 48.0223 46.5899 47.9894C49.619 47.6338 52.6784 48.3943 54.4372 50.9764C54.751 51.4377 56.7176 55.0397 56.5511 55.2497C54.4042 54.238 51.8994 54.5551 49.641 53.8385C47.4611 53.1453 46.1358 51.4308 43.9242 51.03C41.6781 50.6223 39.2147 50.6744 36.9343 50.5893C22.521 50.0498 7.99492 51.1466 -6.41008 50.3079C-9.18181 50.1459 -16.0093 49.6559 -18.225 48.2282C-19.1058 47.6599 -19.4182 46.5974 -18.1782 46.3297L-18.1768 46.3284Z" fill="#1B4712"/><path d="M44.1677 46.3272C45.0829 43.8234 45.6086 41.1685 45.6788 38.5027L45.3678 38.9461L43.4094 45.6381C40.222 41.2921 43.3832 37.1972 46.7123 34.25C47.8918 35.8094 48.6033 37.8163 48.4299 39.8054C48.2055 42.3752 45.9623 44.658 44.1677 46.3286V46.3272Z" fill="#1B4712"/><path d="M56.4134 38.9148C56.017 40.5538 55.7005 42.2491 54.8334 43.7207C53.1889 46.5142 50.0552 47.6728 46.9187 47.6316C49.4937 46.3989 51.4163 44.2341 53.1104 42.0021C53.1297 41.8977 52.9797 41.9156 52.9026 41.932C52.6218 41.9897 50.3979 43.6232 49.9575 43.9362C48.6569 44.8628 47.5036 46.0255 45.9554 46.6007C45.8191 46.4634 47.6743 43.5793 47.9069 43.2636C50.0965 40.293 52.893 39.538 56.4134 38.9148Z" fill="#1B4712"/><path d="M34.808 35.4827C36.8779 36.2116 39.856 37.2686 40.9377 39.3208C41.6699 40.7086 41.9066 42.7663 41.4827 44.2681C40.3184 42.5508 39.3757 40.6222 37.6981 39.3277C38.4165 41.2866 39.5932 43.1493 39.9744 45.2235C39.9964 45.3457 40.1382 45.5873 39.9689 45.6408C38.4385 44.2365 36.2641 43.45 35.3558 41.4568C35.1782 41.0683 34.8066 39.9028 34.8066 39.5336V35.484L34.808 35.4827Z" fill="#1B4712"/></g></svg>`;
    return `data:image/svg+xml;utf8,${encodeURIComponent(unselectedSvg)}`;
};

export const createUserLocationMarker = () => {
    const pulsingDotSvg = `
        <svg width="48" height="48" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
            <g>
                <circle cx="24" cy="24" r="7" fill="#4285F4" stroke="white" stroke-width="2"/>
                <circle cx="24" cy="24" r="22" fill="#4285F4" fill-opacity="0.3">
                    <animate attributeName="r" from="12" to="22" dur="1.5s" begin="0s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" from="0.4" to="0" dur="1.5s" begin="0s" repeatCount="indefinite"/>
                </circle>
            </g>
        </svg>
    `;
    return `data:image/svg+xml;utf8,${encodeURIComponent(pulsingDotSvg)}`;
};

export const getMarkerIcons = (isSelected, isHovered, placeDetails) => {
    const unselectedIcon = createUnselectedMarkerIcon();
    const openIcon = createSelectedMarkerIcon(OPEN_COLOR);
    const closedIcon = createSelectedMarkerIcon(CLOSED_COLOR);
    const closingSoonIcon = createSelectedMarkerIcon(CLOSING_SOON_COLOR);

    const unselectedSize = new window.google.maps.Size(66, 74);
    const activeSize = new window.google.maps.Size(66, 74);

    if (!isSelected && !isHovered) {
        return { url: unselectedIcon, size: unselectedSize };
    }

    if (placeDetails) {
        const status = checkIfOpen(placeDetails);
        if (status.isClosingSoon) {
            return { url: closingSoonIcon, size: activeSize };
        } else if (status.isOpen) {
            return { url: openIcon, size: activeSize };
        }
    }
    
    return { url: closedIcon, size: activeSize };
};